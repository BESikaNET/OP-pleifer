# Система шифрования Плейфера (Playfair Cipher)

Клиент-серверное приложение для реализации алгоритма шифрования Плейфера.

---

## Описание

Система предназначена для шифрования и расшифрования текстовых данных с использованием шифра Плейфера. Консольное приложение реализовано с использованием клиент-серверной архитектуры, где клиентская часть выполняет сбор данных от пользователя и отправляет запрос на сервер для шифрования/расшифрования, а серверная часть выполняет операции шифрования и возвращает результат клиенту.

---

## Архитектура

- **Client (CLI)**: консольное приложение, общается с API по HTTP, хранит локальные зашифрованные логи
- **Server (API)**: Minimal API (.NET 8), шифрование Плейфера, логирование в SQLite, авторизация (cookie)
- **DB**: SQLite (`./data/users.db`) с таблицами `users`, `logs`

---

## Структура проекта

```
PlayfairCipherSystem/
├── Server/           # API
│   ├── Modules/      # Encryption, Logging, Database
│   ├── Program.cs
│   ├── appsettings.json
│   └── Server.csproj
│
├── Client/           # CLI
│   ├── Program.cs
│   ├── Modules/      # Check, Encryption, HttpClient with retries
│   └── Client.csproj
│
├── PlayfairShifr.sln
└── README.md
```

---

## Возможности

- Шифрование и расшифрование текста с использованием шифра Плейфера
- Ручной ввод ключа или автоматическая генерация ключа заданной длины
- Теоретическая справка об алгоритме шифрования
- История операций: локальное хранение и серверные логи
- Авторизация: регистрация/вход (cookie)
- Swagger UI для API
- CLI для работы с API

---

## Быстрый старт

### Сервер

```bash
cd Server
dotnet restore
dotnet run
```

После запуска:
- API сервер: `http://localhost:5247`
- Swagger UI: `http://localhost:5247/swagger`

### Клиент

```bash
cd Client
dotnet restore
dotnet run
```

---

## Использование (CLI)

1. Запустите сервер (см. раздел "Быстрый старт")
2. Запустите клиент в отдельном терминале
3. Войдите или зарегистрируйтесь
4. Выберите действие:
   - Посмотреть теоретическую справку о шифре Плейфера
   - Зашифровать текст (с ручным вводом ключа или автоматической генерацией)
   - Расшифровать текст
   - Просмотреть историю операций
5. Логи: смотрите локальные сохранённые или серверные (нужна авторизация)

---

## API (Swagger)

Открыть `http://localhost:5247/swagger` и использовать интерактивную документацию:
- `POST /api/signup` — регистрация
- `POST /api/login` — вход (устанавливает cookie)
- `GET /api/info` — теоретическая справка о шифре Плейфера
- `POST /api/encrypt` — шифрование текста (cookie обязательна)
- `POST /api/decrypt` — расшифрование текста (cookie обязательна)
- `POST /api/generate-key` — генерация ключа заданной длины (cookie обязательна)
- `GET /api/logs` — история операций (cookie обязательна)

---

## Модульная система (Server)

- **PlayfairCipherModule** — реализация алгоритма шифрования Плейфера
- **LogManager** — логирование в SQLite, хранение входных/выходных текстов и ключей
- **DBManager** — работа с SQLite, пользователи и логи

---

## Алгоритм шифра Плейфера

Шифр Плейфейра — это полиграфический шифр подстановки, который работает с парами символов (биграммами) используя матрицу 5x5, содержащую ключевое слово.

### Алгоритм работы:

1. **Подготовка матрицы:**
   - Создается матрица 5x5 с буквами алфавита (обычно J объединяется с I)
   - Ключевое слово записывается в матрицу, затем добавляются остальные буквы алфавита
   - Каждая буква встречается только один раз

2. **Подготовка текста:**
   - Удаляются все небуквенные символы
   - Текст преобразуется в верхний регистр
   - Если встречаются буквы J, они заменяются на I
   - Текст разбивается на пары символов
   - Если пара содержит одинаковые буквы, между ними вставляется X
   - Если длина текста нечетная, добавляется X в конец

3. **Шифрование:**
   Для каждой пары символов:
   - Если символы в одной строке: заменяются на символы справа (циклически)
   - Если символы в одном столбце: заменяются на символы снизу (циклически)
   - Иначе: образуют прямоугольник, заменяются на символы в противоположных углах

4. **Расшифрование:**
   Обратный процесс с использованием тех же правил, но сдвигами в противоположных направлениях.

---

## Конфигурация

### Сервер
- `PORT` — порт (по умолчанию 5247)
- `ASPNETCORE_URLS` — `http://0.0.0.0:5247`
- `Database:Path` — путь к БД (`./data/users.db` по умолчанию)

### Клиент (CLI)
- `SERVER_URL` — URL API (по умолчанию `http://localhost:5247`)

---

## База данных (SQLite)

- `users`: Id, Login (UNIQUE), Password (SHA256+Base64), CreatedAt
- `logs`: Id, Timestamp (UTC), Level, Message, UserId, InputText, OutputText, Key, OperationType, CreatedAt

---

## Технологии

- .NET 8, ASP.NET Core (Minimal API)
- SQLite
- Swagger / OpenAPI

---

## Лицензия

См. LICENSE в корне репозитория.
